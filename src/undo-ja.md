# ミスを元に戻す

````admonish reset title="Reset your progress" collapsible=true
To reset your progress to the start of this chapter, run the following command:

```sh
curl https://jj-for-everyone.github.io/reset.sh | bash -s undo
cd ~/jj-tutorial/repo
```
````

これまで学んだことで長く進むことができます - 何か問題が起こるまで。
例えば、`jj commit` を実行し、急いで不適切なコミットメッセージを入力したとしましょう。
今、それを修正したいです。

現在のスキルセットでは、`jj commit` を実行した後にコミットの説明を編集することは不可能です。
しかし、何か他のことをした後にミスを**元に戻す**ことができるでしょうか？
時間を遡る？
Jujutsuはコミットだけでなく、リポジトリ自体で行われたすべての操作のログを保存するので、可能です。
リポジトリを特定の時点の状態に復元するための低レベルコマンドがありますが、今は操作を1つずつ元に戻す/やり直す高レベルコマンドを教えます。

```admonish warning title="この章はJujutsu v0.33を必要とします"
以下のものはJujutsuの少なくともバージョン `0.33` で動作します。
それより古いものを使用している場合（`jj --version` で確認）、より最近のバージョンに更新してから続けてください。
実際、`0.33` はまだリリースされていません 😅。
それは9月3日の水曜日にリリースされますので、待つ必要はありません。
```

私たちのリポジトリの現在の状態を思い出しましょう

```sh
cd ~/jj-tutorial/repo
jj log
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">m</span><span class="bold highlighted dimgray ">vwvstxp</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-21 05:08:40</span><span class="bold "> </span><span class="bold highlighted blue ">e7</span><span class="bold highlighted dimgray ">c0e5c3</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ttrxvpr</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-21 05:08:40</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">43f2325</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">v</span><span class="highlighted dimgray ">rzlxpqt</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-21 05:08:40</span> <span class="purple ">push-vrzlxpqtwosl</span> <span class="bold "></span><span class="bold blue ">e2</span><span class="highlighted dimgray ">1774c2</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">wxuxqlr</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-21 05:08:40</span> <span class="bold "></span><span class="bold blue ">4</span><span class="highlighted dimgray ">6c18f61</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

## ミスを作る

リポジトリの状態を変更して、不適切な説明でコミットを作成しましょう。
より多くの言語で世界に挨拶しましょう：

```sh
echo "print('Hallo, Welt!')" >> hello.py
echo "print('Bonjour, le monde!')" >> hello.py
```

今、不適切な説明でそのコミットを作成しましょう：

```sh
jj commit -m "code improvements"
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">qm</span><span class="bold highlighted dimgray ">uzoxnq</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:43:25</span><span class="bold "> </span><span class="bold highlighted blue ">5</span><span class="bold highlighted dimgray ">9a200dc</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">n</span><span class="highlighted dimgray ">qktzmsp</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:43:25</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">3</span><span class="highlighted dimgray ">8be9036</span>
│  code improvements
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wtknypl</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">e</span><span class="highlighted dimgray ">a6c4eeb</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">ttonqou</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="purple ">push-lttonqouuwuo</span> <span class="bold "></span><span class="bold blue ">1</span><span class="highlighted dimgray ">ebfde14</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">qp</span><span class="highlighted dimgray ">tuspzk</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="bold "></span><span class="bold blue ">6</span><span class="highlighted dimgray ">fbc981e</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

## ミスを元に戻す

ミスに気づいたので、今修正しましょう。
リポジトリを以前の時点の状態に復元できます：

```sh
jj undo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">n</span><span class="bold highlighted dimgray ">qktzmsp</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:42:30</span><span class="bold "> </span><span class="bold highlighted blue ">8</span><span class="bold highlighted dimgray ">161ec3f</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold yellow ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">z</span><span class="bold highlighted dimgray ">wtknypl</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">e</span><span class="highlighted dimgray ">a6c4eeb</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">ttonqou</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="purple ">push-lttonqouuwuo</span> <span class="bold "></span><span class="bold blue ">1</span><span class="highlighted dimgray ">ebfde14</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">ptuspzk</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="bold "></span><span class="bold blue ">6</span><span class="highlighted dimgray ">fbc981e</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

素晴らしい！
不適切なコミットメッセージを書く前の状態に戻りました。
今、より良いものを書く2回目のチャンスがあります：

```sh
jj commit -m "Print German and French greetings as well"
```

## さらに戻る

ミスをしてから他のことをした後でミスに気づいたらどうなるでしょうか？
複数の操作を元に戻すことはできますか？
はい、できます！
それは典型的なグラフィカルアプリケーションの "undo" 機能のように動作します（<kbd>Ctrl+Z</kbd> を押すことで知っているかもしれません）。
`jj undo` を実行するたびに、過去に1ステップ戻ります。
それを数回試してみましょう：

```sh
jj undo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">p</span><span class="bold highlighted dimgray ">sqzqsyx</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:47:59</span><span class="bold "> </span><span class="bold highlighted blue ">e</span><span class="bold highlighted dimgray ">e29bb33</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold yellow ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">vtqysnn</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">2</span><span class="highlighted dimgray ">a6d89f8</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wmzptsw</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">push-zwmzptswtkly</span> <span class="bold "></span><span class="bold blue ">7</span><span class="highlighted dimgray ">3c28593</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ytpymws</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">a90dfce</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

```sh
jj undo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">p</span><span class="bold highlighted dimgray ">sqzqsyx</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:47:34</span><span class="bold "> </span><span class="bold highlighted blue ">4</span><span class="bold highlighted dimgray ">110d386</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">vtqysnn</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">2</span><span class="highlighted dimgray ">a6d89f8</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wmzptsw</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">push-zwmzptswtkly</span> <span class="bold "></span><span class="bold blue ">7</span><span class="highlighted dimgray ">3c28593</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ytpymws</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">a90dfce</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

```sh
jj undo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">o</span><span class="bold highlighted dimgray ">stuqosp</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:47:34</span><span class="bold "> </span><span class="bold highlighted blue ">4</span><span class="bold highlighted dimgray ">251a335</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wmzptsw</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">push-zwmzptswtkly</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">7</span><span class="highlighted dimgray ">3c28593</span>
│  WIP: Add for loop (need to fix syntax)
│ <span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">vtqysnn</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">2</span><span class="highlighted dimgray ">a6d89f8</span>
├─╯  Add submission instructions
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ytpymws</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">a90dfce</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

Jujutsuがファイル変更を別の操作として登録したことに気づくでしょう。
`jj` コマンドを実行するたびに、まずファイルシステムで変更がないかチェックします。
変更があれば、それらはワーキングコピーコミットに記録され、_それから_対応するコマンドの操作が行われます。

それは良い例でしたが、元に戻した3つの操作は実際にはミスではありませんでした。
それらを取り戻すことはできますか？
典型的なグラフィカルアプリケーションでは、"redo" ボタンをクリックするか、<kbd>Ctrl+Shift+Z</kbd> を押すことでそれを行います。
Jujutsuでは、`jj redo` コマンドを実行します。
最も最近の状態に戻るためにそれを3回実行しましょう：

```sh
jj redo
jj redo
jj redo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">x</span><span class="bold highlighted dimgray ">urwwlyw</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:48:08</span><span class="bold "> </span><span class="bold highlighted blue ">a</span><span class="bold highlighted dimgray ">510f1a7</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">p</span><span class="highlighted dimgray ">sqzqsyx</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:48:08</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">51eb57e</span>
│  Print German and French greetings as well
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">vtqysnn</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">2</span><span class="highlighted dimgray ">a6d89f8</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wmzptsw</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">push-zwmzptswtkly</span> <span class="bold "></span><span class="bold blue ">7</span><span class="highlighted dimgray ">3c28593</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ytpymws</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">a90dfce</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

`jj redo` をもう一度実行すると、何もやり直すものがないことを示すエラーメッセージが表示されます。

## 元に戻した状態を上書きする

不適切なコミットメッセージを書いたことを覚えていますか？
"code improvements" でした。
まあ、それは `jj undo` と `jj redo` だけでは取り戻せません。
元に戻した状態の上に新しい状態を作成すると、それらの "元に戻した" 状態は "隠される" ようになります。
これは典型的なグラフィカルアプリケーションの "undo" 機能が動作する方法なので、驚かないかもしれません。

典型的なグラフィカルアプリケーションとは異なり、Jujutsuにはそれらの状態を取り戻すより高度なコマンドがあります。
それは将来のトピックです。

## リモートへのプッシュは元に戻せない

リポジトリへの操作は技術的に通常の操作です。
元に戻すことはほとんど常に悪いアイデアです。
リモートがその以前の状態に復元されるわけではなく、リモートは無傷のままです。
`jj undo` がする唯一のことは、リモートにコミットをプッシュしたことを_忘れる_ことです。
これは "conflicted bookmarks" や "divergent change IDs" などの厄介なエラーを引き起こす可能性があります。
両方の問題は解決可能ですが、今はそれらを_どのように_解決するかを教える適切な時間ではありません。
したがって、私のアドバイスは_それをしない_ことです。

`jj git push` 操作を誤って元に戻した場合、`jj redo` でそれを修正してください、それで問題ないはずです。

将来、`jj undo` はリモートと対話する操作を元に戻すことを拒否するかもしれません。

## リポジトリ履歴はリモートにバックアップされない

ローカルでリポジトリを削除することは、リモートがある場合大きな問題ではありません。
リポジトリを再クローンすれば、すべてのコミット履歴が戻ってきます。
しかし、リポジトリ自体で行った操作の履歴はローカルのみです。
したがって、`jj undo` はクローンした時点の状態までしか機能しません。
