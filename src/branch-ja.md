# 履歴の分岐

````admonish reset title="Reset your progress" collapsible=true
To reset your progress to the start of this chapter, run the following command:

```sh
curl https://jj-for-everyone.github.io/reset.sh | bash -s branch
cd ~/jj-tutorial/repo
```
````

これまで、プロジェクトを単独で作業する場合のみをカバーしてきました。
複数の人がプロジェクトに協力したい場合はどうでしょうか？
そのようなシナリオをシミュレートし、何が起こるかを見てみましょう。

AliceとBobはコンピュータサイエンスのクラスでグループプロジェクトに取り組んでいます。
彼らのタスクはPythonで古典的な"Hello, world!"プログラムを書くことです。
AliceとBobは作業を以下のように分担することを決めます：
- AliceはPythonプログラムを書く。
- BobはREADMEにドキュメントを追加する。

Aliceから始めましょう。
彼女が考え出したPythonプログラムはこちらです：

```python
print('Hello, world!')
```

それは仕事を十分にこなします。
彼女はそれを `hello.py` ファイルに追加します：

```sh
echo "print('Hello, world!')" > hello.py
```

変更に満足したAliceは、新しいコミットを作成します：

```sh
jj commit -m "Add Python script for greeting the world

Printing the text \"Hello, world!\" is a classic exercise in introductory
programming courses. It's easy to complete in basically any language and
makes students feel accomplished and curious for more at the same time."
```

この時点でのリポジトリは以下のようになるはずです：

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">s</span><span class="bold highlighted dimgray ">vplvpro</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-07-22 21:17:41</span><span class="bold "> </span><span class="bold highlighted blue ">4</span><span class="bold highlighted dimgray ">db2d0d0</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">zywylnt</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 21:17:31</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">f8</span><span class="highlighted dimgray ">e44920</span>
│  Add Python script for greeting the world
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">k</span><span class="highlighted dimgray ">xqyrwux</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 21:14:46</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">ff</span><span class="highlighted dimgray ">df52d0</span>
│  Add projcet description to readme
~
</pre>

次に、Bobの作業をシミュレートします。
彼はAliceと同じコンピュータで作業しているわけではなく、別のコピーを持っています。
BobはAliceと同時に作業しているので、彼女のコミットはまだ持っていません。
私たちのプライマリリポジトリと同じリモートを持つ3番目のリポジトリを作成することで、これをシミュレートできます：

```
jj git clone --colocate ~/jj-tutorial/remote ~/jj-tutorial/repo-bob
```

そのリポジトリに入り、ロールプレイのために著者情報を設定し、Aliceが作業を開始したときと同じようにログが表示されるようにしましょう：

```sh
cd ~/jj-tutorial/repo-bob
jj config set --repo user.name Bob
jj config set --repo user.email bob@local
jj describe --reset-author --no-edit
jj log
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">q</span><span class="highlighted dimgray ">uolxwkk</span><span class="bold "> </span><span class="bold yellow ">bob@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-07-22 21:19:11</span><span class="bold "> </span><span class="bold highlighted blue ">3</span><span class="highlighted dimgray ">ffac111</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">k</span><span class="highlighted dimgray ">xqyrwux</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 21:14:46</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">f</span><span class="highlighted dimgray ">fdf52d0</span>
│  Add projcet description to readme
~
</pre>

それは素晴らしい。
BobはAliceと同じように作業を開始します：

```sh
echo "# jj-tutorial

The file hello.py contains a script that greets the world.
It can be executed with the command 'python hello.py'.
Programming is fun!" > README.md

jj commit -m "Document hello.py in README.md

The file hello.py doesn't exist yet, because Alice is working on that.
Once our changes are combined, this documentation will be accurate."
```

Bobはドキュメントだけをしているので、Aliceよりも少し速かったと言います。
したがって、Bobは最初に `main` ブックマークを更新します：

```sh
jj bookmark move main --to @-
jj git push
```

少し後、Aliceも完了しました。
今彼女は `main` ブックマークを更新しようとしますが、失敗します：

```sh
cd ~/jj-tutorial/repo
jj bookmark move main --to @-
jj git push
```

<!-- generated by aha script -->
<pre class="aha">
Changes to push to origin:
  Move forward bookmark main from cd5f3fff9c7b to e90b597ed78e
<span class="bold "></span><span class="bold red ">Error: </span><span class="bold ">Failed to push some bookmarks</span>
<span class="bold "></span><span class="bold cyan ">Hint: </span>The following references unexpectedly moved on the remote:
  <span class="green ">refs/heads/main</span> (reason: stale info)
<span class="bold "></span><span class="bold cyan ">Hint: </span>Try fetching from the remote, then make the bookmark point to where
       ↪ you want it to be, and push again.
</pre>

Aliceはパニックしそうになりますが、ソーシャルメディアを開いて少しスクロールし、カエルがアヒルの赤ちゃんの群れと一緒にくつろぐビデオを見つけます！
それはとてもかわいい。
今彼女の神経が落ち着いたので、ターミナルに戻り、エラーメッセージを実際に読むことにします。
彼女はそれを修正する方法についての有用な情報が含まれていることに安心します。
ヒントに従って、まずリモートからフェッチします：

```sh
jj git fetch
```

`fetch` は新しいコマンドで、`push` の反対です。
`push` がローカルリポジトリからリモートにブックマークとコミットを送信するのに対し、`fetch` は誰か（Bobのような）が別のコンピュータからプッシュしたブックマークとコミットをダウンロードします。

結果の `jj log` はこちらです：

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">s</span><span class="bold highlighted dimgray ">vplvpro</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-07-22 21:17:41</span><span class="bold "> </span><span class="bold highlighted blue ">4</span><span class="bold highlighted dimgray ">db2d0d0</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">zywylnt</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 21:17:31</span> <span class="purple ">main?? main@git</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">f8</span><span class="highlighted dimgray ">e44920</span>
│  Add Python script for greeting the world
│ <span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">uolxwkk</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-07-22 21:22:22</span> <span class="purple ">main?? main@origin</span> <span class="bold "></span><span class="bold blue ">8</span><span class="highlighted dimgray ">d538390</span>
├─╯  Document hello.py in README.md
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">k</span><span class="highlighted dimgray ">xqyrwux</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 21:14:46</span> <span class="bold "></span><span class="bold blue ">ff</span><span class="highlighted dimgray ">df52d0</span>
│  Add projcet description to readme
~
</pre>

おお！
これはこれまでに見たことのないものです。
私たちのバージョン履歴が2つの**ブランチ**に分岐しています。
これは珍しいことではなく、Jujutsuが人々が互いに独立して作業することを可能にするコアにあります。
しかし、この状況に対処する方法はまだ知りません。

JujutsuがBobの更新を知らずに `main` ブックマークをプッシュすることを許可した場合、Bobの作業が誤って削除されるでしょう。
リモートは**到達可能**なコミットのみを保持する価値があると見なすことを思い出してください。
`main` ブックマークがAliceのコミットを指す場合、Bobのコミットは**到達可能**ではなくなります、なぜならそれはAliceのコミットの祖先ではないからです。

`main` ブックマークがログに**2回**表示され、両方とも疑問符 **`??`** が付いていることに注意してください。
これはJujutsuがブックマークをどこに指すべきかわからないことを意味します。
Aliceはそれを自分のコミットに移動しましたが、リモートではBobのコミットに移動されました。
Aliceが実際にどこを指すべきかを決めたら、Jujutsuにそれを伝えることができます。

```admonish info title="混乱を招く用語: ブックマークとブランチ"
"ブックマーク" と "ブランチ" の用語は非常に似た状況でしばしば使用され、混乱を招きます。
違いを非常に正確に定義し、潜在的な混乱源を認識するようにしましょう。

**ブックマーク** は単に単一のコミットを指す、またはポイントする名前付きラベルです。
それだけです。

**ブランチ** はその**先端**によって指定され、それはまた単一のコミットです。
しかし、ブランチは先端と**そのすべての祖先**を含む**コミットのセット**を指します。

これら2つの概念は、"mainブランチに変更をプッシュする" というフレーズで組み合わせることができます。
これは混乱するかもしれません、"main" はブックマークだから、なぜ "mainブランチ" について話しているのでしょうか？
まあ、`main` ブックマークはコミットを指し、そのコミットは私たちが "mainブランチ" と呼ぶブランチの先端です。

もう一つ覚えておくべきことは、Gitを主に使用する人々と話すときです。
Gitは常に両方のことを "branch" と呼びます。
Gitには "bookmark" の意味はありません。
したがって、Gitユーザーが "branch" という言葉を使うとき、彼らは実際のブランチ、つまり先端とその祖先のコミットのセットを意味するかもしれません。
彼らはブックマーク、つまり単一のコミットを指す名前付きラベルを意味するかもしれません、そのポイントされたコミットの祖先に意味を付けずに。
```

それはすべて興味深いことで、私たちのコミットのツリー状のグラフはとてもきれいに見えますが、教師はプログラムとドキュメントの両方を含むバージョンを望んでいます。
AliceとBobは何をすべきでしょうか？
次の章で調べてください！
