# リベース

````admonish reset title="Reset your progress" collapsible=true
To reset your progress to the start of this chapter, run the following command:

```sh
curl https://jj-for-everyone.github.io/reset.sh | bash -s rebase
cd ~/jj-tutorial/repo-bob
```
````

Bobのリポジトリに戻っていることを思い出してください：

```sh
cd ~/jj-tutorial/repo-bob
```

Bobは2番目のコミットに満足したので、リモートにプッシュしようとします。
以前Aliceのように失敗します：

```sh
jj bookmark move main --to @-
jj git push
```

Bobの解決策はAliceと同じようにリモートからフェッチすることです：

```sh
jj git fetch
```

Bobのログが今どうなっているかを見てみましょう：

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">z</span><span class="bold highlighted dimgray ">tyvwqll</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-07-22 21:29:52</span><span class="bold "> </span><span class="bold highlighted blue ">9</span><span class="bold highlighted dimgray ">3f27644</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">s</span><span class="highlighted dimgray ">mswwyok</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-07-22 21:29:27</span> <span class="purple ">main?? main@git</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">e</span><span class="highlighted dimgray ">583fa6e</span>
│  Add submission instructions
│ <span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">t</span><span class="bold highlighted dimgray ">wywpklt</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 21:27:24</span> <span class="purple ">main?? main@origin</span> <span class="bold "></span><span class="bold blue ">6</span><span class="highlighted dimgray ">06959ce</span>
╭─┤  <span class="green ">(empty)</span> Merge code and documentation for hello-world
│ │
│ ~
│
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">uolxwkk</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-07-22 21:22:22</span> <span class="bold "></span><span class="bold blue ">8</span><span class="highlighted dimgray ">d538390</span>
│  Document hello.py in README.md
~
</pre>

それは基本的に同じ状況です。
BobとAliceの変更が異なる方向に分岐しています。
それらを組み合わせるために、BobはAliceと同じようにマージコミットを作成できます。
しかし、Bobはマージコミットが好きではありません。
彼のログを直線的に保つことを好みます。
Aliceとは異なるアプローチを取ることに決めます。

Bobは彼の変更をAliceの変更の上に最初から行ったふりをします。
彼の最も最近のコミットはAliceのコミットを親に持つべきです、それにより**線形履歴**になります。

これを行うためのJujutsuコマンドがあります：
それは`rebase`と呼ばれます。
名前が示すように、それはコミットをある"base"（祖先）から別の"base"に移動します。
`jj rebase`はそれ自体では機能しませんが、**宛先**を指定する必要があります。
この場合、Bobは彼のコミットをリモートの`main`ブックマークの状態の上に移動したい、すなわちAliceのコミット。
したがって、彼はコマンドを実行します：

```sh
jj rebase --destination main@origin
```

ログはどうでしょうか？

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">z</span><span class="bold highlighted dimgray ">tyvwqll</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-07-22 21:30:38</span><span class="bold "> </span><span class="bold highlighted blue ">e</span><span class="highlighted dimgray ">911e4c7</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">s</span><span class="highlighted dimgray ">mswwyok</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 21:30:38</span> <span class="purple ">main*</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">0</span><span class="highlighted dimgray ">2bd1179</span>
│  Add submission instructions
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">t</span><span class="highlighted dimgray ">wywpklt</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 21:27:24</span> <span class="purple ">main@origin</span> <span class="bold "></span><span class="bold blue ">6</span><span class="highlighted dimgray ">06959ce</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

素晴らしい、それはBobが望んだものです。
Jujutsuは`main`ブックマークがBobの新しいコミットを指すべきだとさえ推測しました。
残りはブックマークをもう一度プッシュすることだけです：

```sh
jj git push
```

Bobが今行ったことはパラダイムシフトです：
彼は**履歴を書き換えました**。
履歴は以前Bobの2番目のコミットが彼の最初のコミットの子であると言っていましたが、今はAliceのコミットの子であると言っています。
この修正主義の範囲はまだ無害ですが、このチュートリアルを進めるにつれて、履歴操作の暗黒芸術をさらに深く探求します。

<div style="display: flex; justify-content: center">
<b style="color: red">
真実そのものがあなたの意志に曲がる
</b>
</div>

さて、どこまで進んでいたでしょうか？

小さな詳細を説明しました。
`rebase`コマンドはコミットを_あるbase_から新しいものに移動すると言いました。
その_以前のbase_は何でしょうか？
`--destination`フラグを使用すると、Jujutsuはワーキングコピーと新しいbaseの最初の共有祖先を_リベース元の古いbase_として選択します。
シンプルな用語では、`rebase`コマンドは宛先ブランチにまだないコミットのみを移動します。
私たちの例では、移動するコミットは1つだけでした。

マージコミットを作成することとリベースすることは、異なる方向に分岐した変更を再結合するための両方の有効な方法です。
それぞれに長所と短所があります。
一部の人はある側面を他方よりも重視し、どちらが優れているかという強い意見を持つようになります。
以下は主なトレードオフのバランスの取れた概要です：

| | 利点 | 欠点 |
| --- | --- | --- |
| **マージ** | 履歴を起こったとおりに正確に保存します。 | 読みにくい、絡まった履歴になる可能性があります。 |
| **リベース** | 読みやすい線形履歴になります。 | 起こった順序を偽ります。 |

正しい意見を決定したら、インターネット上のすべての人にあなたの重要な発見を伝えてください！
