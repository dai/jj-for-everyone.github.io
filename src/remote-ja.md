# リモートにコミットを送信する

````admonish reset title="Reset your progress" collapsible=true
To reset your progress to the start of this chapter, run the following command:

```sh
curl https://jj-for-everyone.github.io/reset.sh | bash -s remote
cd ~/jj-tutorial/repo
```
````

今、私たちは失いたくないコミットを持っています。
これまでJujutsuを使用してきた方法では、バックアップがまったくありません。
この `~/jj-tutorial/repo` ディレクトリをディスクから削除したらどうなるでしょうか？
`.git` と `.jj` サブディレクトリも削除されます。
バージョン履歴データベースはそこに保存されているので、作業を回復できません！

リモートと呼ばれる別の場所にコミットを複製することで、これを修正できます。
バックアップを提供するだけでなく、リモートにコミットを送信することもコラボレーションを容易にします。

リモートの最も人気のある形式は、GitHubなどのオンラインサービスでリポジトリをホストすることです。
それはアカウントと少しセットアップが必要ですが、このチュートリアルではよりシンプルなアプローチを使用します。
コンピュータ上の別の場所にリモートを保存します。
それはバックアップとしては悪いですが、学習には完璧です。
GitHubを使用する方法については後の章でヒントがあります。

## リモートの初期化

リモートとして使用する新しいリポジトリを初期化するコマンド：

```sh
git init --bare ~/jj-tutorial/remote # "remote" ("bare") リポジトリを初期化
```

このチュートリアルでは詳細を説明しません、なぜならそれらが重要でないからです。
もし好奇心があるなら、expand the text box below を展開してください。

````admonish note title="bare リポジトリと通常のリポジトリの違い" collapsible=true
`git init --bare` は私たちのメインリポジトリを作成するために使用した `jj git init` と非常に似ています。
しかし、通常のリポジトリの代わりに "bare" を作成します。
違いは何でしょうか？

通常のリポジトリは2つの部分で構成されていると考えてください：（1）`.git` と `.jj` ディレクトリに保存されたJujutsuの内部データベースと（2）変更できるプロジェクトの実際のファイル、ワーキングコピー。
"copy" という用語は重要です、なぜならファイルは内部データベースにも保存されているからです。
ワーキングコピーが存在する唯一の理由は、ファイルを読み取り変更できるようにするためです、"work" with them。
ワーキングコピーは適切な名前です。

bare リポジトリはワーキングコピーなしの通常のリポジトリです。
リモートリポジトリをコミットの送信と受信のみに使用するので、ワーキングコピーは必要ありません。

私たちのメインリポジトリの `.git` ディレクトリの内容と比較して、新しいbareリポジトリの内容を検査できます：
```
ls -lah ~/jj-tutorial/repo/.git
ls -lah ~/jj-tutorial/remote
```
````

## リモートへの接続

リポジトリは特定の名前でリモートに接続されます。
リモートが1つしかない場合、**origin** と呼ぶのが慣習です：

```sh
jj git remote add origin ~/jj-tutorial/remote
```

ここではファイルシステム上のパスでリモートに接続します。
GitHubや同様のサービスでホストされたリポジトリの場合、パスはURLに置き換えられます。
それについては後で。

## ブックマークの追加

リモートがコミットを受信する前に、1つの速度バンプがあります。
リモートリポジトリは多くのコミットを受信できますが、すべてが長期的に保持される価値があるわけではありません。
リモートがコミットを削除するかどうかを知る方法は？
ブックマークで！

ブックマークはコミットを指す単純な名前付きラベルです。
そのブックマークラベルを持つすべてのコミットは重要と見なされ、自動的に削除されません。
このメカニズムにより、リモートにコミットを送信するにはブックマークが**必須**です。

**main** と呼ばれるブックマークを作成し、それを完了したコミットにポイントしましょう。
"main" という名前はプロジェクトの主要な状態を表す強い慣習です。
レガシープロジェクトでは "master" という名前も広く使用されています。

```sh
jj bookmark create main --revision mkmqlnox # <- ここにあなたの change ID を置き換えてください
```

`jj bookmark create` コマンドは名前（`main`）とブックマークがポイントするコミットを期待します。
コミットを change ID で識別します（`--revision mkmqlnox`）。
`--revision` フラグは `-r` に短縮できます。
`jj log` で結果を確認しましょう：

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">p</span><span class="bold highlighted dimgray ">wpuwyto</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-07-22 20:22:36</span><span class="bold "> </span><span class="bold highlighted blue ">3</span><span class="bold highlighted dimgray ">5de496a</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">m</span><span class="highlighted dimgray ">kmqlnox</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-07-22 20:25:40</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">7</span><span class="highlighted dimgray ">939d4cf</span>
│  Add readme with project title
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">zzzzzzz</span> <span class="green ">root()</span> <span class="bold "></span><span class="bold blue ">0</span><span class="highlighted dimgray ">0000000</span>
</pre>

素晴らしい！
ブックマーク `main` が完了したコミットを正しくポイントしていることがわかります。

## ブックマークのプッシュ

今、リモートにコミットを送信する準備ができました。
送信する技術的な用語は "pushing" です。
"リモートにプッシュする" や "GitHubにプッシュする" というフレーズをよく聞くでしょう。
特定のブックマークをプッシュするコマンドは：

```sh
jj git push --bookmark main --allow-new
```

完全に新しいものをプッシュするには追加のフラグ `--allow-new` または `-N` が必要です。
これは既存のブックマークを上書きしないようにする安全対策です。
この安全対策を煩わしいと感じる人が多いです。
Jujutsuの貢献者はこれを改善する方法を検討しています。
今は次のコマンドでそれを無効にできます：

```sh
jj config set --user git.push-new-bookmarks true
```
