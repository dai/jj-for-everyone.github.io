# バージョンコントロールからファイルを除外する

````admonish reset title="Reset your progress" collapsible=true
To reset your progress to the start of this chapter, run the following command:

```sh
curl https://jj-for-everyone.github.io/reset.sh | bash -s ignore
cd ~/jj-tutorial/repo
```
````

Bobのチェックをしましょう：

```sh
cd ~/jj-tutorial/repo-bob
```

提出を終えたBobは、次の課題について考えています。
教師は `submission_alice_bob.tar.gz` という名前のtarballを期待しています。
少しの [試行錯誤](https://xkcd.com/1168/) の後、彼はtarballを作成するコマンドを考え出しました：

```sh
tar czf submission_alice_bob.tar.gz README.md
```

（進めて実行してください！）

BobはAliceが最終提出をする場合にこの手間を省くために、ドキュメントに追加することを決めます：

```sh
echo "
## Submission

Run the following command to create the submission tarball:

~~~sh
tar czf submission_alice_bob.tar.gz [FILE...]
~~~" >> README.md
```

Bobはリモート共有とAliceにクリーンなコミットのみをプッシュするように注意します。
（Bobのようにしてください！）
彼はコミットの内容を `jj show` でダブルチェックします：

<!-- generated by aha script -->
<pre class="aha">
Commit ID: <span class="blue ">596961f1e4aaa66f50b918902efbc839122184f4</span>
Change ID: <span class="purple ">vtkxsvmtporzvtpovlpqvytrpzxyuykn</span>
Bookmarks: <span class="purple ">main??</span> <span class="purple ">main@origin</span>
Author   : <span class="yellow ">Bob</span> &lt;<span class="yellow ">bob@local</span>&gt; (<span class="cyan ">2025-08-04 20:38:40</span>)
Committer: <span class="yellow ">Bob</span> &lt;<span class="yellow ">bob@local</span>&gt; (<span class="cyan ">2025-08-04 20:38:59</span>)

<span class="yellow ">    (no description set)</span>

<span class="yellow ">Modified regular file README.md:</span>
    ...
<span class="red ">   3</span> <span class="green ">   3</span>: The file hello.py contains a script that greets the world.
<span class="red ">   4</span> <span class="green ">   4</span>: It can be executed with the command 'python hello.py'.
<span class="red ">   5</span> <span class="green ">   5</span>: Programming is fun!
     <span class="green ">   6</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">   7</span>: <span class="underline "></span><span class="underline green ">## Submission</span><span class="green "></span>
     <span class="green ">   8</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">   9</span>: <span class="underline "></span><span class="underline green ">Run the following command to create the submission tarball:</span><span class="green "></span>
     <span class="green ">  10</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">  11</span>: <span class="underline "></span><span class="underline green ">~~~sh</span><span class="green "></span>
     <span class="green ">  12</span>: <span class="underline "></span><span class="underline green ">tar czf submission_alice_bob.tar.gz [FILE...]</span><span class="green "></span>
     <span class="green ">  13</span>: <span class="underline "></span><span class="underline green ">~~~</span><span class="green "></span>
<span class="yellow ">Added regular file submission_alice_bob.tar.gz:</span>
<span class="cyan ">    (binary)</span>
</pre>

おお！
彼の研究の結果がコミットに記録されているようです。
tarball `submission_alice_bob.tar.gz` はバージョンコントロールに属していません。

デフォルトでは、Jujutsuはプロジェクト内のすべてのファイルをワーキングコピーに入れます、それは通常望ましいです。
しかし、時々、特定のファイルを除外してバージョンコントロールから除外するようにJujutsuに指示する必要があります。
この目的のために、Jujutsuは存在する場合 `.gitignore` ファイルを読み取ります。
このファイルには、バージョンコントロールから除外するファイル、ディレクトリ、パターンのリストを含めることができます。

Bobは `.gitignore` ファイルにtarballのパターンを追加して問題を修正します：

```sh
echo "*.tar.gz" > .gitignore
```

アスタリスク `*` 記号は特殊な [glob](https://en.wikipedia.org/wiki/Glob_(programming)) 文字で、`submission_alice_bob` を含む任意のファイル名に展開できます。
`.gitignore` ファイルに正確なファイル名 `submission_alice_bob.tar.gz` を追加するだけでも動作しましたが、上記のパターンは_任意_のtarballをカバーします。

````admonish info title="ファイルをグローバルに無視する" collapsible=true
複数のプロジェクトで同じファイルが散らばっていて、あなたの個人的な使用のみを意図している場合があります。
その場合、すべてのプロジェクトの `.gitignore` に個人ファイルを追加するのは少し面倒です。

macOSユーザーに特に関連する一つの例：
Finderアプリケーションは開いたディレクトリに隠しファイル `.DS_Store` を保存します。
これらはどこにでも現れ、バージョンコントロールに属することはほとんどありません。
macOSユーザーなら、グローバル `.gitignore` ファイルに `.DS_Store` を追加することを検討してください：

```sh
echo ".DS_Store" >> ~/.gitignore
```
````

コミットの内容をもう一度チェックしましょう：

<!-- generated by aha script -->
<pre class="aha">
Commit ID: <span class="blue ">c9bc30b48922c767c553392709f212b8c0815ceb</span>
Change ID: <span class="purple ">vtkxsvmtporzvtpovlpqvytrpzxyuykn</span>
Bookmarks: <span class="purple ">main??</span> <span class="purple ">main@origin</span>
Author   : <span class="yellow ">Bob</span> &lt;<span class="yellow ">bob@local</span>&gt; (<span class="cyan ">2025-08-04 20:38:40</span>)
Committer: <span class="yellow ">Bob</span> &lt;<span class="yellow ">bob@local</span>&gt; (<span class="cyan ">2025-08-04 20:41:13</span>)

<span class="yellow ">    (no description set)</span>

<span class="yellow ">Added regular file .gitignore:</span>
     <span class="green ">   1</span>: <span class="underline "></span><span class="underline green ">*.tar.gz</span><span class="green "></span>
<span class="yellow ">Modified regular file README.md:</span>
    ...
<span class="red ">   3</span> <span class="green ">   3</span>: The file hello.py contains a script that greets the world.
<span class="red ">   4</span> <span class="green ">   4</span>: It can be executed with the command 'python hello.py'.
<span class="red ">   5</span> <span class="green ">   5</span>: Programming is fun!
     <span class="green ">   6</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">   7</span>: <span class="underline "></span><span class="underline green ">## Submission</span><span class="green "></span>
     <span class="green ">   8</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">   9</span>: <span class="underline "></span><span class="underline green ">Run the following command to create the submission tarball:</span><span class="green "></span>
     <span class="green ">  10</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">  11</span>: <span class="underline "></span><span class="underline green ">~~~sh</span><span class="green "></span>
     <span class="green ">  12</span>: <span class="underline "></span><span class="underline green ">tar czf submission_alice_bob.tar.gz [FILE...]</span><span class="green "></span>
     <span class="green ">  13</span>: <span class="underline "></span><span class="underline green ">~~~</span><span class="green "></span>
<span class="yellow ">Added regular file submission_alice_bob.tar.gz:</span>
<span class="cyan ">    (binary)</span>
</pre>

うーん... `.gitignore` ファイルが加わりましたが、tarballは_まだ_コミットに記録されています。
理由は、Bobが `.gitignore` を追加する前にファイルが既に追跡を開始していたからです。
Jujutsuは既に追跡されたファイルを `.gitignore` で考慮しません。
幸い、Jujutsuには既に追跡されたファイルを追跡停止するコマンドがあります：

```sh
jj file untrack submission_alice_bob.tar.gz
```

`untrack` コマンドは、追跡停止するファイルが既に `.gitignore` に存在する場合のみ動作します。
そうでない場合、Jujutsuはそれをすぐに再追跡します。
ディレクトリ全体を一度に無視して追跡停止することもできます。

コミットの内容をもう一度チェックしましょう：

<!-- generated by aha script -->
<pre class="aha">
Commit ID: <span class="blue ">0f0015beb53d8c83f3bbcfe938a9bf031834c3e4</span>
Change ID: <span class="purple ">vtkxsvmtporzvtpovlpqvytrpzxyuykn</span>
Bookmarks: <span class="purple ">main??</span> <span class="purple ">main@origin</span>
Author   : <span class="yellow ">Bob</span> &lt;<span class="yellow ">bob@local</span>&gt; (<span class="cyan ">2025-08-04 20:38:40</span>)
Committer: <span class="yellow ">Bob</span> &lt;<span class="yellow ">bob@local</span>&gt; (<span class="cyan ">2025-08-04 20:41:36</span>)

<span class="yellow ">    (no description set)</span>

<span class="yellow ">Added regular file .gitignore:</span>
     <span class="green ">   1</span>: <span class="underline "></span><span class="underline green ">*.tar.gz</span><span class="green "></span>
<span class="yellow ">Modified regular file README.md:</span>
    ...
<span class="red ">   3</span> <span class="green ">   3</span>: The file hello.py contains a script that greets the world.
<span class="red ">   4</span> <span class="green ">   4</span>: It can be executed with the command 'python hello.py'.
<span class="red ">   5</span> <span class="green ">   5</span>: Programming is fun!
     <span class="green ">   6</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">   7</span>: <span class="underline "></span><span class="underline green ">## Submission</span><span class="green "></span>
     <span class="green ">   8</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">   9</span>: <span class="underline "></span><span class="underline green ">Run the following command to create the submission tarball:</span><span class="green "></span>
     <span class="green ">  10</span>: <span class="underline "></span><span class="underline green "></span><span class="green "></span>
     <span class="green ">  11</span>: <span class="underline "></span><span class="underline green ">~~~sh</span><span class="green "></span>
     <span class="green ">  12</span>: <span class="underline "></span><span class="underline green ">tar czf submission_alice_bob.tar.gz [FILE...]</span><span class="green "></span>
     <span class="green ">  13</span>: <span class="underline "></span><span class="underline green ">~~~</span><span class="green "></span>
</pre>

やった！
このコミットはきれいで整っています。説明を付けて完了しましょう：

```sh
jj commit -m "Add submission instructions"
```
